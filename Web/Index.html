<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
</head>
<body>
    <div id="bathroomData">
    </div>

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-3.1.1.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        $(function () {
            var bathroomHub = $.connection.bathroomHub;

            bathroomHub.client.listLatests = function (data) {
                var obj = data;

                if (obj.length > 0)
                    obj.forEach((item) => {
                        item = JSON.parse(item);
                        var roomStatus = item["roomStatus"];
                        var time = item["time"];
                        var newDate = new Date(time);

                        var dateTime = newDate.getDate() + "/"
                        + (newDate.getMonth() + 1) + "/"
                        + newDate.getFullYear() + " @ "
                        + newDate.getHours() + ":"
                        + newDate.getMinutes()

                        // Add the data to the page.
                        $('#bathroomData').append('<li><strong>' + roomStatus
                            + ' - ' + dateTime + '</strong></li>');
                    })
            };

            bathroomHub.client.updateStatus = function (data) {
                console.log(data);

                var obj = JSON.parse(data);
                var roomStatus = obj["roomStatus"];
                var time = obj["time"];
                var newDate = new Date(time);

                var dateTime = newDate.getDate() + "/"
                + (newDate.getMonth() + 1) + "/"
                + newDate.getFullYear() + " @ "
                + newDate.getHours() + ":"
                + (newDate.getMinutes() < 10 ? '0' : '') + newDate.getMinutes()

                // Add the data to the page.
                if (roomStatus == "Occupied") {
                    $('#bathroomData').append('<li style=color:red;><strong>' + roomStatus
                    + ' - ' + dateTime + '</strong></li>');
                }
                else
                {
                    $('#bathroomData').append('<li style=color:green;><strong>' + roomStatus
                    + ' - ' + dateTime + '</strong></li>');
                }
                
            }

            //Call Init
            $.connection.hub.start().done(function () {
                bathroomHub.server.get();
            });
        });
    </script>
</body>
</html>
